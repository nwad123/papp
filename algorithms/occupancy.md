# Occupancy Profiling for All Sets

In the original version of the Prefetcher-Aware Prime and Probe (PAPP) paper an 
algorithm was used to generate occupancy profiling for a single set. The reason 
that we use this algorithm to generate data for a single set at a time is that 
if we do it for _all_ sets then it generates really big datasets. I originally 
did it for _all_ sets and naively used a CSV format to output the data, and 
I ended up with a massive 10 Gb CSV that our lab machine could not really handle.

So, I had to regenerate results individually for each set, $s$.

This algorithm originates from the [original PAPP authors][PappGithub].

```
m <- number of sets in target cache
n <- number of lines per set (could be greater than physical limit)
N <- number of test iterations
s <- set currently being tested

ES <- eviction set of size m x n

For iter In 0..N Do
    For line In ES Do
        Flush ES from the cache 
        Prime set s in ES 
        Record access time to line 
    End For
End For 
```

This algorithm is almost directly implemented in [occupancy_profile.c](../src/occupancy_profile.c). 
Results from this algorithm are generated by the `occupancy` target, generated from the main function 
in [occupancy.c](../occupancy.c), and are written to CSV files in the [results/occupancy/](../results/occupancy/)
folder. Figures are written to the [figs/occupancy](../figs/occupancy/) folder.

[PappGithub]: (https://github.com/seclab-ucr/PAPP/blob/a18a230dd941e7d0cf2290a39981172b8651eac1/Pseudocode_Algorithm.pdf)
